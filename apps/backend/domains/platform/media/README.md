# Platform Media

Минимальный платформенный домен для загрузки и раздачи файлов без внешних сервисов.

- Порт: `ports/storage_port.py`
- Сервис: `application/storage_service.py`
- Адаптер: `adapters/local_storage.py` — хранит в `apps/backendDDD/var/uploads` с шардированием `xx/yy/<uuid>.<ext>`
- API: `api/http.py`
  - `POST /v1/media` — загрузка (jpeg/png/webp, ≤5MB)
  - `GET /v1/media/file/{name:path}` — отдача файла
- DI: `wires.py` — контейнер с `storage` и `upload_dir`

## TODO

- Конфигурация
  - Вынести `max_size`, допустимые MIME/расширения, `base_dir`, `public_route_prefix` в `Settings`.
  - Опциональная сегментация по профилю/тенанту (префикс пути) и валидация владельца.
- Безопасность/доступ
  - Режим «приватных» файлов: выдача по подписанным URL, ограничение времени, заголовки `Cache-Control`.
  - Авторизация на скачивание (middleware/порт IAM).
- Квоты и лимиты
  - Лимит по числу/объёму файлов на пользователя/тенант (интеграция с `platform/quota`).
  - Rate‑limit на загрузку.
- Очистка и жизненный цикл
  - Фоновый GC: удаление неиспользуемых/просроченных файлов по TTL.
  - Маркировка/версионирование при перезаписи, soft‑delete.
- Качество/обработка контента
  - Нормализация изображений: ресайз, сжатие, WebP/AVIF, EXIF‑стриппинг.
  - Верификация MIME по сигнатуре (не по расширению), антивирус (по необходимости).
- Дедупликация
  - Хранение по хешу содержимого (SHA‑256): дедуп, счётчик ссылок.
- Наблюдаемость
  - Метрики загрузок/выдач, объёмов; интеграция с `platform/telemetry`.
- Расширение адаптеров
  - Добавить S3/MinIO адаптер (с сохранением текущего интерфейса) и CDN заголовки.
- API дополнения
  - Удаление файла (`DELETE /v1/media/file/{name}`) и список файлов владельца.
  - HEAD/Range поддержка для больших файлов.

