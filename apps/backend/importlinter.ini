[importlinter]
root_package = apps.backend

[importlinter:layers_platform_domains]
name = layers for platform domains
type = layers
containers =
    apps.backend.domains.platform.moderation
    apps.backend.domains.platform.notifications
    apps.backend.domains.platform.flags
    apps.backend.domains.platform.users
layers =
    (tests)
    (wires)
    api : (ai_rules) : (appeals) : (content) : (overview) : (reports) : (tickets) : (users)
    application : (logic) : (workers)
    adapters.memory, adapters.sql
    domain : (models) : (ports) : (ports_notify) : (schema) : (dtos)
exhaustive = true
; Temporary waiver until worker bootstrap moves to container registry
ignore_imports =
    apps.backend.domains.platform.notifications.workers.broadcast -> apps.backend.domains.platform.notifications.wires

[importlinter:layers_product_profile]
name = layers for product/profile
type = layers
layers =
    apps.backend.domains.product.profile.api
    apps.backend.domains.product.profile.application
    apps.backend.domains.product.profile.domain
    apps.backend.domains.product.profile.adapters.memory, apps.backend.domains.product.profile.adapters.sql

[importlinter:layers_product_nodes]
name = layers for product/nodes
type = layers
layers =
    apps.backend.domains.product.nodes.api
    apps.backend.domains.product.nodes.application
    apps.backend.domains.product.nodes.domain
    apps.backend.domains.product.nodes.adapters.memory, apps.backend.domains.product.nodes.adapters.sql

[importlinter:no_gateway_internals]
name = gateway must use container registry
type = forbidden
source_modules =
    apps.backend.app.api_gateway.main
    apps.backend.app.api_gateway.wires
forbidden_modules =
    apps.backend.domains.platform.*.domain
    apps.backend.domains.platform.*.application
    apps.backend.domains.platform.*.adapters
    apps.backend.domains.product.*.domain
    apps.backend.domains.product.*.application
    apps.backend.domains.product.*.adapters

[importlinter:layers_platform_search]
name = layers for platform/search
type = layers
layers =
    apps.backend.domains.platform.search.api
    apps.backend.domains.platform.search.application
    apps.backend.domains.platform.search.ports
    apps.backend.domains.platform.search.adapters.memory, apps.backend.domains.platform.search.adapters.sql

[importlinter:layers_platform_telemetry]
name = layers for platform/telemetry
type = layers
layers =
    apps.backend.domains.platform.telemetry.api
    apps.backend.domains.platform.telemetry.application
    apps.backend.domains.platform.telemetry.domain
    apps.backend.domains.platform.telemetry.adapters.memory, apps.backend.domains.platform.telemetry.adapters.sql

[importlinter:forbid_platform_app_product_internals]
name = platform application cannot import product internals
type = forbidden
source_modules =
    apps.backend.domains.platform.*.application
forbidden_modules =
    apps.backend.domains.product.*.application
    apps.backend.domains.product.*.adapters

[importlinter:forbid_product_app_platform_internals]
name = product application cannot import platform internals
type = forbidden
source_modules =
    apps.backend.domains.product.*.application
forbidden_modules =
    apps.backend.domains.platform.*.application
    apps.backend.domains.platform.*.adapters

