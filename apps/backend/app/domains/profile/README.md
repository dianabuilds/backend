# Profile

## Миссия
Публичная карточка профиля и самосервисные настройки пользователя (display‑уровень): username/display name, avatar, bio, язык/локаль, ссылки, предпочтения. Публикация профильно‑ориентированных событий.

## Границы
- Владеет: публичный API профиля (`/profile/*`), правила доступа к профилю, доменные события `profile.*`.
- Читает/пишет: ограниченный набор колонок в таблице `users` (username, avatar_url, bio) и таблицу `user_profiles` (locale/lang, timezone, links, preferences).
- Не владеет: аутентификация, токены, роли, ограничения, кошельки, удаление аккаунта — это домен Users.
- Антикоррупционный слой: доступ к данным Users осуществляется через инфраструктурный репозиторий `ProfileRepository`, который собирает проекцию профиля из `users` и `user_profiles`.

## Язык (Ubiquitous Language)
| Термин | Определение | Источник правды |
|-------|-------------|-----------------|
| Profile | публичная карточка профиля | `users` + `user_profiles` |
| Preferences | пользовательские настройки | `user_profiles.preferences` |

## Внешние контракты
- HTTP: `/profile/{user_id}`, `PATCH /profile/{user_id}` (алиасы `/profile/me*` см. план миграции).
- События: `profile.updated.v1` при изменении профиля.

## Инварианты
- Профиль может изменять только владелец (subject.id == resource.user_id).
- `username` уникален (гарантирует Users/БД). Профиль уважает ограничение; конфликт маппится в 409 (планируется).

## Политики и доступ
Чтение публично, изменение — владелец. См. `infra/policy.yaml` и `application/policies.py`.

## Версионирование
SemVer для API профиля, SchemaRev для событий. Депрекейт через переходный период. Старые users‑роуты `/users/me/profile`, `/users/me/settings` планируются к проксированию/переводу на сервис профиля.
