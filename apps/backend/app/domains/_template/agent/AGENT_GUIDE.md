# Agent Guide — {{DOMAIN}} Domain

Этот гайд дополняет общий `backend/AGENTS.md` и задаёт правила для домена {{DOMAIN}}. Все изменения проходят цикл: План → Тесты → Код → Самоаудит → PR.

## Scope
- Разрешено: `app/domains/{{domain}}/**`, при необходимости `app/domains/registry.py` (подключение роутера) и схемы в `app/schemas`.
- Миграции — в корневом Alembic; в домене храним дизайн‑спеки в `schema/sql/` и ссылку в ADR.

## Definition of Done
- Обновлён `schema/openapi.yaml` и синхронизирован с FastAPI‑ручками и моделями.
- Соблюдены инварианты и политики (описать в `application/policies.py`).
- События домена оформлены в `events/specs/*` и публикуются через outbox (если применимо).
- Линтеры/типы зелёные, тесты домена зелёные.

## Контракты API
- Сначала правка `schema/openapi.yaml`, затем модели и код ручек.
- Только ап‑совместимые изменения. Breaking → новая версия API или переключатель.

## События и версионирование
- Публикация через `app.domains.system.platform.outbox.emit` (фасад System Outbox).
- Добавление полей допускается; breaking → `.vN+1` и новый паблишер.

## Слои
- `application` (use‑cases, policies) не зависит от `infrastructure` во время выполнения.
- Реализации портов — в `infrastructure/{repositories,adapters}`.
- Роутер — только оркестрация/авторизация/валидация, без бизнес‑логики.

## Тесты
- Unit: сервисы и политики (`tests/unit`).
- Контрактные: соответствие вводу/выводу схемам, мок outbox (если события).
- E2E (по необходимости): ключевые сценарии из `application/workflows/*`.

## Коммиты и артефакты
- Коммиты: `feat(domain-{{domain}}): ...`, `fix(domain-{{domain}}): ...`.
- ADR на ключевые решения (схемы, события, политики).
