# Wave 0 — задачи подготовки

## Задача W0-1 — Восстановить `scripts/validate_repo.py`
- **Описание**: проверить существование и актуальность скрипта валидации репозитория, содержащего запуск ruff, mypy, bandit, vulture, pip-audit, cyclonedx и health bench, либо обновить документацию, если скрипт больше не используется.
- **Шаги выполнения**:
  1. Проверить, существует ли `scripts/validate_repo.py` и соответствует ли он требованиям из `CodeValidator.md`.
  2. Если отсутствует — восстановить скрипт с актуальными командами и логикой отчётов (`reports/validate_repo.md`).
  3. Запустить скрипт локально, убедиться, что все шаги проходят или корректно фиксируют ошибки.
  4. Обновить `CodeValidator.md` под итоговую реализацию.
- **Определение готовности**: собраны требования к проверкам, доступ к инструментам (ruff, mypy, bandit, vulture, pip-audit, cyclonedx, health bench) подтверждён.
- **Определение завершения**: скрипт присутствует и выполняется без падений; `CodeValidator.md` отражает фактическое поведение; отчёт `reports/validate_repo.md` генерируется.

## Задача W0-2 — Собрать dependency map фронтенда
- **Описание**: построить карту зависимостей слоёв фронтенда (layout → pages → widgets/features → entities/shared) и выявить нарушения.
- **Шаги выполнения**:
  1. Настроить инструмент (например, `madge` или `eslint-plugin-boundaries`) для анализа импортов в `apps/web/src`.
  2. Сгенерировать карту зависимостей (граф/отчёт) и сохранить в `var/frontend-deps`. 
  3. Зафиксировать найденные нарушения (импорты вверх по слоям, обращения к `vendor` и т.п.) в отдельном разделе документации.
  4. Обновить `docs/code-audit-plan-2025.md` ссылкой на отчёт и кратким описанием найденных проблем.
- **Определение готовности**: доступны инструменты для анализа (npm-пакеты, конфиг ESLint), известно целевое разбиение на слои.
- **Определение завершения**: отчёт сохранён, список нарушений задокументирован, ссылка добавлена в основной план.

## Задача W0-3 — Снять снимок importlinter для бэкенда
- **Описание**: актуализировать правила `importlinter` и получить отчёт о нарушениях для доменов `platform/*` и `product/*`.
- **Шаги выполнения**:
  1. Запустить `python -m importlinter.cli lint --config apps/backend/importlinter.ini`.
  2. Сохранить полный отчёт в `var/backend-import-lint.txt`.
  3. При необходимости обновить `importlinter.ini`, если появились новые домены или слои, и повторить запуск.
  4. Суммаризировать выявленные нарушения в документе Wave 2 (если есть) и в общем плане.
- **Определение готовности**: установлен Python env, доступен `importlinter`, конфигурация актуальна.
- **Определение завершения**: отчёт сохранён, нарушения перечислены, конфиг при необходимости обновлён.
- **Артефакты**: `var/backend-import-lint.txt` (11.10.2025, нарушений не обнаружено); обновлены контракты importlinter (`layers_product_worlds`, `layers_product_ai`, `layers_product_premium`).

## Задача W0-4 — Сбор baseline метрик
- **Описание**: собрать стартовые показатели для Lighthouse (главная страница и dev-блог), pytest coverage, времени отклика ключевых API и размера фронтового бандла.
- **Шаги выполнения**:
  1. Выполнить Lighthouse аудит (`npm run build && npm run preview`, затем `npx lighthouse ...`) и сохранить JSON в `var/lighthouse-home.json` и `var/lighthouse-devblog.json`.
  2. Запустить `pytest -c apps/backend/pytest.ini --cov` и сохранить `coverage.xml`/`html` в `var/`.
  3. Прогнать скрипт бенчмарков/HTTPx для ключевых API (nodes, moderation) и сохранить результаты.
  4. Зафиксировать размер фронтового бандла (`vite build --report` или анализ через `vite --mode analyze`).
  5. Обновить `docs/code-audit-plan-2025.md` таблицей baseline метрик и ссылками на отчёты.
- **Определение готовности**: доступны тестовое окружение, инструменты Lighthouse/pytest/httpx, определён перечень проверяемых страниц/эндпоинтов.
- **Определение завершения**: отчёты сохранены в `var/`, baseline таблица добавлена в документ, результаты согласованы с командой.

## Задача W0-5 — Согласовать целевые показатели и критерии
- **Описание**: уточнить и документировать целевые показатели (Lighthouse ≥ 85, mypy=0, coverage ≥ 85%, CI ≤ 10 мин и т.д.) с заинтересованными сторонами.
- **Шаги выполнения**:
  1. Провести митинг/асинхронный созвон с продуктом, маркетингом, безопасностью для подтверждения метрик.
  2. Собрать обратную связь и при необходимости скорректировать цели.
  3. Внести итоговые показатели в `docs/code-audit-plan-2025.md` и вспомогательные документы (например, фронт/бэк-гайды).
  4. Зафиксировать список ответственных за отслеживание метрик.
- **Определение готовности**: подготовлен черновик метрик и контакты участников.
- **Определение завершения**: цели подтверждены, документ обновлён, назначены ответственные.
- **Артефакты**: `docs/code-audit-plan-2025.md#критерии-качества-и-метрики`, `var/lighthouse-home.json`, `var/lighthouse-devblog.json`, `var/frontend-bundle.json`, `reports/validate_repo.md`.

