# Руководство по админке взаимодействия с нодами

Документ служит постоянной инструкцией по устройству админского раздела `Node Engagement`. Он описывает, какие элементы обязательны, как они работают и каким тестированием покрываются.

## Назначение
- обеспечить модераторам единое рабочее место для управления нодами, комментариями и банами;
- синхронизировать UI с требованиями ADR `2025-10-02-node-engagement.md`;
- задать проверяемые требования для продуктовой, QA и аналитической команд.

## Основные модули интерфейса
### Карточка ноды
- Показывает статус, ключевые счётчики (просмотры, лайки, комментарии), дату последнего обновления.
- Действия: `Заблокировать`, `Отключить`, `Обновить статистику`. Все destructive действия требуют подтверждения.
- В шапке — ссылки на журналы и связанные сущности (автор, жалобы, квесты).

### Комментарии
- Древовидный список с пагинацией и фильтрами (`status`, `author`, `hasFlags`, диапазон дат).
- Inline-действия: удаление/восстановление, переключение статуса `pending ↔ hidden`, переход к родителю.
- Отображается индикатор глобальных ограничений (read-only режим, массовые блокировки).

### Баны и ограничения
- Таблица активных и исторических банов с фильтрами, возможность добавления/редактирования через модалку.
- Быстрые действия: `Разбанить`, `Добавить бан`, просмотр журнала причин.
- Виджет состояния комментариев синхронизирован с карточкой ноды.

### Аналитика
- Графики просмотров и реакций, распределение статусов, экспорт CSV.
- Показываем задержку данных и источник (`analytics`, `event-store`).
- Поддерживаем выбор диапазона дат и сравнение периодов.

## Правила UX и аналитики
- Используем ограничения из `docs/admin-ui-interaction-rules.md`: не больше трёх быстрых действий, все destructive действия с подтверждением, соблюдение таб- и клавиатурной навигации.
- Для каждого действия и метрики добавляем `data-testid` и `data-analytics` с осмысленными именами (`node-engagement:ban:add`, `node-engagement:metric:views`).
- Состояния загрузки/ошибок унифицируем с другими админскими экранами (Skeleton/Empty/Error из `shared/ui`).
- Все строки и описания храним в UTF-8, локализации выделяем в ресурсы при расширении языков.

## Тестирование
### E2E
- Сценарий модератора: создание/снятие банов, блокировка/разблокировка комментариев, восстановление веток, проверка аналитики.
- Проверяем работу фильтров, экспорт CSV, отображение задержки данных.

### Юнит и компоненты
- Покрываем карточку ноды, дерево комментариев, модалки банов, графики. Используем Testing Library + Vitest/Jest.
- Проверяем, что действия вызывают правильные API-клиенты и обновляют локальное состояние.

### Доступность
- Тестируем таб-навигацию, фокус в модалках, aria-атрибуты для кнопок и таблиц.
- Проверяем работу с экранными считывателями на ключевых сценариях (переходы между комментариями, подтверждение действий).

### Данные и фикстуры
- Готовим тестовые данные: ноды с разными статусами, пользователи с историей банов, ветки комментариев разной глубины.
- Обновляем чек-листы в `docs/backend-testing-strategy.md` и e2e-фикстуры.

## Связанные материалы
- `docs/api/node-engagement-admin.md` — детали API.
- `docs/admin-ui-interaction-rules.md` — общие принципы админского UI.
- `adr/2025-10-02-node-engagement.md` — стратегические решения по разделу.

