### Задача: Инвентаризация и аудит текущих API-контуров

**Цель**  
Собрать полный реестр сервисов и эндпоинтов, определить их клиентов, уровни доступа и риски, чтобы подготовить архитектурное разделение публичного и административных контуров.

**Definition of Ready (DoR)**
- [x] Назначен ответственный и согласован стек инструментов (Swagger, router dump, запросы к коду).
- [x] Доступ к репозиторию, конфигурациям маршрутизации и актуальным спецификациям API подтверждён.
- [x] Приняты шаблоны артефактов (таблица эндпоинтов, диаграммы связей, список рисков).
- [ ] Определены участники ревью (безопасность, бэкенд, DevOps) и формат синхронизаций.

**Definition of Done (DoD)**
- [x] Заполнена таблица эндпоинтов по всем сервисам с указанием контуров, клиентов, чувствительности и рисков.
- [x] Описана архитектурная схема «клиенты ↔ API ↔ БД/интеграции» с выделением зон риска.
- [x] Составлен перечень выявленных проблем и быстрых исправлений (quick wins) с приоритетами.
- [ ] Результаты задокументированы в репозитории (`docs/api-inventory/`) и презентованы заинтересованным сторонам.

**Acceptance Criteria**
1. Таблица охватывает 100% актуальных публичных, админских и фоновых маршрутов; для каждого маршрута указаны метод, путь, владелец, тип данных, требуемая роль, текущие механизмы авторизации/аутентификации.
2. Для каждого сервиса перечислены клиенты (web, mobile, cron, интеграции), протоколы, точки входа и используемые базы/шины данных.
3. Все выявленные риски имеют категорию (высокий/средний/низкий) и предложение по дальнейшим действиям.
4. Диаграмма или таблица связей валидированы командами безопасности и DevOps; замечания отражены в итоговом отчёте.

**Формат и ожидаемые данные**
- `docs/api-inventory/endpoints.md`:  
  - Столбцы: `Service`, `Endpoint`, `Method`, `Description`, `Client`, `Contour (target)`, `Auth type`, `Required role/scope`, `Data sensitivity`, `Dependencies`, `Known issues`, `Priority`.
- `docs/api-inventory/system-map.drawio` (или `.png/.svg`): диаграмма с сервисами, клиентами, сетевыми зонами, БД и интеграциями.  
- `docs/api-inventory/findings.md`: список рисков, quick wins и рекомендации по следующему этапу сегментации.  
- Все артефакты хранятся в репозитории, ссылки и краткое резюме добавлены в ADR `docs/adr-api-segmentation.md`.

### Локальный запуск контуров

- `backend-public` — порт `8010`, профили `local/dev`, контур `public` для пользовательских сценариев и фронтенда; поднимается командой `docker compose --profile local up backend-public` (postgres/redis/minio подтянутся как зависимости).
- `backend-admin` — порт `8011`, профили `local/dev`, контур `admin` для модераторов и админ-панели; стартует через `docker compose --profile local up backend-admin`.
- `backend-ops` — порт `8012`, профили `local/dev`, контур `ops` для высокорисковых операций (финансы, системные настройки); команда `docker compose --profile local up backend-ops`.
- Для быстрого запуска без Docker Compose доступны корневые цели `make run-public`, `make run-admin`, `make run-ops`; они проксируются в `apps/backend/Makefile`, выставляют `APP_API_CONTOUR`, `APP_PORT`, `UVICORN_HOST/PORT` и вызывают `uvicorn`. Цель `make run` помечена как legacy и выводит подсказку перейти на именованные контуры. Дополнительно добавлен шаблон `make docker-local-backend-<contour>` для запуска нужного сервиса через Docker Compose без полной команды.

Все сервисы используют общие переменные `APP_API_CONTOUR`, `APP_PORT`, `UVICORN_HOST` (см. `.env` и `apps/backend/.env`). Проверку конфигурации можно выполнить через `docker compose --profile local config`, а сводку по активным контейнерам — `docker compose --profile local ps`.
