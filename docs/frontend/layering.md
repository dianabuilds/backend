# Правила слойности фронтенда

Документ фиксирует структуру слоёв пользовательского интерфейса и порядок миграций. Он заменяет проектные заметки и используется как постоянная инструкция.

## Цель
- обеспечить повторяемую архитектуру для макетов и страниц;
- сократить число обратных импортов и неочевидных зависимостей;
- упростить ревью, тестирование и перенос фич между продуктами.

## Стандартные слои
| Слой | Расположение | Ответственность |
|------|--------------|-----------------|
| `layout` | `src/shared/layouts` | каркас страницы, хедеры, боковые панели, глобальные фильтры |
| `pages` | `src/pages/*` | сборка готовой страницы, маршрутизация, загрузка данных |
| `widgets/features` | `src/widgets`, `src/features` | композиция UI и бизнес-логики вокруг одной задачи |
| `entities` | `src/entities` | модели, форматирование данных, хранилища |
| `shared` | `src/shared/ui`, `src/shared/lib`, `src/shared/api` | переиспользуемые компоненты, утилиты, API-клиенты |

## Правила импортов
- `pages` обращаются только к `widgets/features`, `entities`, `shared`. Прямые импорты из других страниц запрещены.
- `features` могут зависеть от `entities` и `shared`, но не от `pages`.
- `shared` не импортирует ничего из верхних слоёв; допускаются только внутренние зависимости `shared`.
- Для временных миграций используем каталог `internal/*` и удаляем его по завершении.

## Процесс миграции
1. **Инвентаризация:** фиксируем компоненты и зависимости, которые переносим. Обновляем Storybook и документацию при необходимости.
2. **Подготовка слоя:** создаём новый layout/виджет в целевом слое, описываем публичный API (пропсы, события, слоты).
3. **Перенос кода:** переносим реализацию и тесты, переименовываем импорты, обновляем alias'ы.
4. **Проверка:** запускаем `npm run lint`, `npm run lint:deps`, unit/Vitest тесты, визуальные снапшоты.
5. **Документация:** обновляем README компонента, при необходимости дополняем `../features/site-editor/page-hero.md` или другие гайды.

## Контроль качества
- Проверка зависимостей и нарушения импортов описана в `./dependency-audit.md`.
- Новые layout'ы требуют сториз и Chromatic-снимков.
- При изменении API виджетов обновляем QA-чеклисты и e2e-тесты.

## Интеграция с аудитом
- Раз в спринт список слоёв сверяется с `../playbooks/code-audit.md`.
- Крупные миграции фиксируются отдельной ADR или записью в `../playbooks/performance.md`, если затрагивается производительность.
