# Spike Next.js вЂ” СЂРµР·СѓР»СЊС‚Р°С‚С‹ Рё РЅР°Р±Р»СЋРґРµРЅРёСЏ

Р”РѕРєСѓРјРµРЅС‚ С„РёРєСЃРёСЂСѓРµС‚ РёС‚РѕРіРё РїРµСЂРІРѕРЅР°С‡Р°Р»СЊРЅРѕРіРѕ spike (СЌС‚Р°Рї 2 РїР»Р°РЅР°) РїРѕ Р·Р°РїСѓСЃРєСѓ Next.js РІРёС‚СЂРёРЅС‹ Рё РёРЅС‚РµРіСЂР°С†РёРё СЃ С‚РµРєСѓС‰РёРј Site Editor.

## 1. Р‘Р°Р·РѕРІС‹Р№ РїСЂРѕРµРєС‚
- РЎРѕР·РґР°РЅРѕ РїСЂРёР»РѕР¶РµРЅРёРµ `apps/web-next` (`next@14.2.15`, `react@18.2.0`), СЃР±РѕСЂРєР° С‡РµСЂРµР· Webpack, СЃС‚СЂРѕРіРёР№ СЂРµР¶РёРј РІРєР»СЋС‡С‘РЅ (`next.config.mjs`).
- ESLint РїРµСЂРµРІРµРґС‘РЅ РЅР° РєР»Р°СЃСЃРёС‡РµСЃРєРёР№ РєРѕРЅС„РёРі (`.eslintrc.json`) СЃ `next/core-web-vitals`.
- Tailwind СѓРґР°Р»С‘РЅ, СЃС‚РёР»Рё вЂ” CSS Modules + РіР»РѕР±Р°Р»СЊРЅС‹Рµ С‚РѕРєРµРЅС‹ (`src/app/globals.css`).

## 2. РџСѓР±Р»РёС‡РЅР°СЏ СЃС‚СЂР°РЅРёС†Р° `/[slug]`
- Р РµР°Р»РёР·РѕРІР°РЅ SSR-СЂРѕСѓС‚ `app/[slug]/page.tsx` Рё РіР»Р°РІРЅР°СЏ `app/page.tsx`, РёСЃРїРѕР»СЊР·СѓСЋС‰РёРµ `getSitePage` РёР· `src/lib/site-page-api.ts`.
- Р¤РµС‚С‡ РёРґС‘С‚ РЅР° СЃСѓС‰РµСЃС‚РІСѓСЋС‰РёР№ `/v1/public/site-page` (РїРѕРєР° Р±РµР· РЅРѕРІРѕРіРѕ `/v1/public/site-page`). Р‘Р°Р·Р° Р±РµСЂС‘С‚СЃСЏ РёР· `SITE_API_BASE` / `NEXT_PUBLIC_SITE_API_BASE`, fallback вЂ” `http://127.0.0.1:8000`.
- Р”РѕР±Р°РІР»РµРЅ `SitePageView` СЃ РѕС‚РѕР±СЂР°Р¶РµРЅРёРµРј Р±Р»РѕРєРѕРІ/СЌР»РµРјРµРЅС‚РѕРІ, РѕР±СЂР°Р±РѕС‚РєРѕР№ fallbacks, `generateMetadata` РїРѕРґС‚СЏРіРёРІР°РµС‚ SEO-РґР°РЅРЅС‹Рµ.
- РџСЂРё РЅРµРґРѕСЃС‚СѓРїРЅРѕСЃС‚Рё API РІС‹РІРѕРґРёС‚СЃСЏ placeholder Рё Р»РѕРіРёСЂСѓРµС‚СЃСЏ РїСЂРµРґСѓРїСЂРµР¶РґРµРЅРёРµ, С‡С‚РѕР±С‹ dev-СЂРµР¶РёРј СЂР°Р±РѕС‚Р°Р» Р±РµР· Р±СЌРєРµРЅРґР°.

## 3. Р’СЃС‚СЂР°РёРІР°РЅРёРµ С‚РµРєСѓС‰РµРіРѕ Site Editor
- Р”РѕР±Р°РІР»РµРЅР° СЃС‚СЂР°РЅРёС†Р° `/legacy/site-editor` СЃ iframe РЅР° Vite-РїСЂРёР»РѕР¶РµРЅРёРµ (СѓРїСЂР°РІР»СЏРµС‚СЃСЏ `NEXT_PUBLIC_LEGACY_SITE_EDITOR_URL`, РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ `http://localhost:5173/management/site-editor`).
- Р­РєСЂР°РЅ РѕСЃС‚Р°РІР»СЏРµРј РґРѕ РїРѕР»РЅРѕР№ РјРёРіСЂР°С†РёРё Р°РґРјРёРЅ-РјР°СЂС€СЂСѓС‚РѕРІ, С‡С‚Рѕ РїРѕР·РІРѕР»СЏРµС‚ Р·Р°РїСѓСЃРєР°С‚СЊ Next.js Рё Р°РєС‚СѓР°Р»СЊРЅС‹Р№ СЂРµРґР°РєС‚РѕСЂ РїР°СЂР°Р»Р»РµР»СЊРЅРѕ.

## 4. РЎР»РµРґСѓСЋС‰РёРµ С€Р°РіРё (РґР»СЏ РїРµСЂРµС…РѕРґР° Рє СЌС‚Р°РїСѓ 3 РїР»Р°РЅР°)
1. РџРѕРґРєР»СЋС‡РёС‚СЊ СЂРµР°Р»СЊРЅС‹Р№ `/v1/public/site-page`, РєРѕРіРґР° Р±СЌРєРµРЅРґ Р±СѓРґРµС‚ РіРѕС‚РѕРІ: РґРѕСЂР°Р±РѕС‚Р°С‚СЊ `site-page-api.ts` РїРѕРґ РЅРѕРІС‹Р№ РєРѕРЅС‚СЂР°РєС‚ + ETag/ISR.
2. РќР°СЃС‚СЂРѕРёС‚СЊ shared-РїР°РєРµС‚С‹/С‚РёРїРёР·Р°С†РёСЋ (РѕР±С‰РёРµ РјРѕРґРµР»Рё Р±Р»РѕРєРѕРІ РјРµР¶РґСѓ `apps/web` Рё `apps/web-next`).
3. РЈС‚РѕС‡РЅРёС‚СЊ DevOps: Node 18+, Р·Р°РїСѓСЃРє `npm run dev` РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ Next + РїСЂРѕРєСЃРё РґР»СЏ SPA, РїР°СЂР°РјРµС‚СЂС‹ РѕРєСЂСѓР¶РµРЅРёР№ (`SITE_ORIGIN`, `LEGACY_SITE_EDITOR_URL`).
4. РџСЂРѕС†РµСЃСЃ revalidate Р·Р°РєСЂРµРїР»С‘РЅ: `publish_page` Рё `publish_global_block` РІС‹Р·С‹РІР°СЋС‚ Next preview API (`/api/preview`) РїРѕ slug/locale, `revalidateTag` РѕР±РЅРѕРІР»СЏРµС‚ РєРµС€.

## 5. Р‘С‹СЃС‚СЂС‹Р№ СЃС‚Р°СЂС‚ РґР»СЏ Р»РѕРєР°Р»СЊРЅРѕР№ РїСЂРѕРІРµСЂРєРё
```bash
cd apps/web-next
npm install
SITE_API_BASE=http://127.0.0.1:8000 \
SITE_ORIGIN=http://localhost:3000 \
NEXT_PUBLIC_LEGACY_SITE_EDITOR_URL=http://localhost:5173/management/site-editor \
npm run dev
```
- `http://localhost:3000/` вЂ” РґРѕРјР°С€РЅСЏСЏ СЃС‚СЂР°РЅРёС†Р° (slug `main`).
- `http://localhost:3000/{slug}` вЂ” Р»СЋР±Р°СЏ СЃС‚СЂР°РЅРёС†Р° РёР· Site Editor.
- `http://localhost:3000/legacy/site-editor` вЂ” РІСЃС‚СЂР°РёРІР°РЅРёРµ С‚РµРєСѓС‰РµРіРѕ СЂРµРґР°РєС‚РѕСЂР°.

## 6. РћС‚РєСЂС‹С‚С‹Рµ РІРѕРїСЂРѕСЃС‹
- РўСЂРµР±СѓРµС‚СЃСЏ РїРѕРґС‚РІРµСЂРґРёС‚СЊ С„РёРЅР°Р»СЊРЅС‹Рµ Р·РЅР°С‡РµРЅРёСЏ `SITE_API_BASE`/`SITE_ORIGIN` (staging/prod).
- РќСѓР¶РµРЅ РјРµС…Р°РЅРёР·Рј Р°РІС‚РѕСЂРёР·Р°С†РёРё РґР»СЏ SSR (cookies/headers), РїРѕРєР° РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ Р°РЅРѕРЅРёРјРЅС‹Р№ РїСѓР±Р»РёС‡РЅС‹Р№ СЌРЅРґРїРѕРёРЅС‚.
- Р”Р»СЏ dev-СЂРµР¶РёРјР° СЃС‚РѕРёС‚ СЂРµС€РёС‚СЊ, РЅСѓР¶РµРЅ Р»Рё РїСЂРѕРєСЃРё РІРјРµСЃС‚Рѕ iframe (С‡С‚РѕР±С‹ РїСѓС‚СЊ `/management/site-editor` СЃСЂР°Р·Сѓ РїРѕРїР°РґР°Р» РЅР° Vite-РїСЂРёР»РѕР¶РµРЅРёРµ).

> РС‚РѕРіРё РјРѕР¶РЅРѕ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ РїСЂРё РѕР±РЅРѕРІР»РµРЅРёРё ADR (СЌС‚Р°Рї 2: РѕС‚РјРµС‚РєР° С‡РµРєР±РѕРєСЃРѕРІ, РїРѕРґРіРѕС‚РѕРІРєР° Р±СЌРєР»РѕРіР° Р·Р°РґР°С‡ РЅР° API Рё shared СЃР»РѕР№).


