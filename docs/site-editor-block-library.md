# Библиотека блоков публичного сайта

Документ фиксирует текущее и планируемое наполнение библиотеки `BlockDefinition`. Используется при подготовке каталога блоков в редакторе и синхронизации с командами контента/продукта.

## 1. Текущие определения (`apps/web/src/features/management/home/blockDefinitions.ts`)

| ID (`type`) | Категория | Назначение | Источник данных | Основные слоты/поля | Типовые страницы | Владелец (подтвердить) | Статус |
|-------------|-----------|------------|-----------------|---------------------|-------------------|-------------------------|--------|
| `hero` | Hero / Первый экран | Большой экран с H1, сабтайтлом, CTA и медиа | `none` (контент задаётся вручную) | `headline`, `subheadline`, `cta`, `media`, `layout.variant` | Главная (`/`), будущие лендинги | Маркетинг | ✅ в коде, требуется JSON schema и документация |
| `dev_blog_list` | Контентные списки | Лента постов дев-блога | `auto` → `dev_blog` (`limit`, `order`) | `headline` | `/` (секция блога), `/dev-blog` | DevRel / Контент | ✅ |
| `quests_carousel` | Каталоги | Карусель популярных квестов | `auto` → `quest` (`limit`, `order`) | — (только данные) | `/`, `/promo/*` | Продакт Quests | ✅ |
| `nodes_carousel` | Каталоги | Подборка рекомендованных нод | `auto` → `node` (`limit`, `order`) | — | `/`, `/promo/*` | Продакт Nodes | ✅ |
| `popular_carousel` | Каталоги | Самые просматриваемые сущности | `auto` → `node` (`limit`, `order`) | — | `/`, `/promo/*` | Маркетинг | ✅ |
| `editorial_picks` | Ручные подборки | Список материалов от редакции | `manual` → `node` (`items`) | `headline`, `description` | `/`, тематические лендинги | Редакция контента | ✅ |
| `recommendations` | Персонализация | Автоматические рекомендации | `auto` → `node` (`order: personalized_desc`) | — | `/`, `/promo/*` | Data/ML | ✅ (потребует API адаптера) |
| `custom_carousel` | Промо | Произвольные карточки | `manual` → `custom` (`items`, layout) | `layout` | `/promo/*`, будущие кампании | Маркетинг | ✅ (нужна схема слотов) |

Примечания:
- Для всех блоков необходимо формализовать JSON Schema (`docs/schema/home_config.schema.json`) и добавить примеры в Storybook/документацию.
- В колонке «Владелец» указаны предполагаемые команды — требуется подтверждение на grooming.
- Блок `recommendations` зависит от API рекомендаций; нужен адаптер с моками для предпросмотра.
- Для авто-источников в UI каталога подключён единый адаптер: при наличии живых данных используем `fetchNodesList`/`fetchDevBlogList`, при ошибке или пустом результате fallback на моки (`apps/web/src/features/site-editor/mocks`). До подключения навигационного сервиса блок `recommendations` временно берёт данные из `/v1/admin/nodes/list?order=personalized_desc` и помечается бейджем `Mock`, когда работает от локального фида.

### Идентификаторы блоков (якоря)

- <span id="hero"></span>`hero`
- <span id="dev_blog_list"></span>`dev_blog_list`
- <span id="quests_carousel"></span>`quests_carousel`
- <span id="nodes_carousel"></span>`nodes_carousel`
- <span id="popular_carousel"></span>`popular_carousel`
- <span id="editorial_picks"></span>`editorial_picks`
- <span id="recommendations"></span>`recommendations`
- <span id="custom_carousel"></span>`custom_carousel`
- <span id="global_header"></span>`global_header`
- <span id="global_footer"></span>`global_footer`
- <span id="faq_list"></span>`faq_list`
- <span id="promo_banner"></span>`promo_banner`
- <span id="related_posts"></span>`related_posts`
- <span id="metrics_highlight"></span>`metrics_highlight`

## 2. Планируемые блоки (из ADR и миграционного плана)

| ID | Категория | Назначение | Источник данных | Статус | Комментарии |
|----|-----------|------------|-----------------|--------|-------------|
| `global_header` | Глобальные блоки | Навигация и CTA сайта | `manual` → `custom` + `locale` | Дизайн в работе | Требует отдельной CRUD-формы, зависимые страницы предупреждать при публикации |
| `global_footer` | Глобальные блоки | Контакты, соцсети, ссылки | `manual` → `custom` + `locale` | Дизайн в работе | Нужна локализация ссылок и юридических текстов |
| `faq_list` | Контент | FAQ для справки/лендингов | `manual` → `faq` или `auto` из базы | Исследование | Зависит от решения по структуре `/help` |
| `promo_banner` | Промо | Одноэкранный CTA с изображением | `manual` | Исследование | Должен поддерживать расписание и таргетинг |
| `related_posts` | Контент | «Читайте также» для статей | `auto`/`manual` → `dev_blog` | Исследование | Нужен коннектор к системе нод |
| `metrics_highlight` | Метрики | Плашка KPI/статистики | `manual` / `auto` | Исследование | Использовать для главной и промо-страниц |

## 3. Требования к каталогу блоков

1. **Фильтры и поиск:** категория, источник данных (`manual`/`auto`/`mixed`), тип страницы, владелец. Поиск по label и описанию.
2. **Карточка блока:** превью (скриншот или динамический рендер), краткое описание, контакты владельца, кнопка «Подробнее» с документацией.
3. **Предпросмотр:** загрузка данных через адаптеры; fallback на моки; поддержка RU/EN локалей с явным переключателем.
4. **Документация:** ссылка на Storybook, JSON Schema, best practices по наполнению.

## 4. Следующие действия

1. Утвердить таблицу владельцев и страниц для текущих блоков (с участием маркетинга, продукта, Data/ML).
2. Подготовить JSON Schema и мок-данные для блоков из таблицы «Текущие определения».
3. Обновить ADR и UX-спецификации каталога с ссылкой на данный документ.
4. Создать карточки задач для разработки каталога, адаптеров данных и Storybook.

## 5. Требования к данным, мокам и тестам

- **JSON Schema:** для каждого блока поддерживать схему настроек и слотов (`home_config.schema.json`), синхронизировать с TypeScript типами (`HomeBlock`).
- **Моки предпросмотра:** хранить в `apps/web/src/features/site-editor/mocks/*` (структура: `<block-id>/<locale>.json`), покрывать RU/EN и edge-кейсы (пустые списки, ошибки адаптера).
- **Фиды данных:** для auto-источников описать контракт адаптера (`/v1/site/blocks/{id}/preview`), обеспечить возможность подмены моками в dev/staging.
- **Storybook:** каждый блок должен иметь историю с ручным и авто сценарием, документировать доступные свойства и ограничения.
- **Тесты:** unit (валидация схем, адаптеры), интеграционные (вставка блоков в страницу, работа источников), e2e (поток выбора → настройки → предпросмотр → сохранение). Покрытие критичного happy-path не ниже 80% по блокам с auto источниками.
