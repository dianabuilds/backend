{% extends "base.html" %}
{% import "components/macros.html" as ui %}

{% block content %}

<!-- Actions bar -->
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
  <div>
    <h1 class="text-2xl font-bold">Premium Users</h1>
    <p class="text-sm opacity-70">Управление премиум‑подписками и быстрый поиск</p>
  </div>
  <div class="flex gap-2">
    {{ ui.searchbar("/admin/premium", "Поиск по username или ID", query) }}
    <button class="btn btn-primary" @click="$refs.premiumModal.showModal()">Добавить премиум</button>
  </div>
</div>

<!-- Table -->
{% call ui.table_container() %}
<table class="table table-zebra">
  <thead>
    <tr>
      <th class="w-24">ID</th>
      <th>Username</th>
      <th class="w-48">Until</th>
      <th class="w-40 text-right">Действия</th>
    </tr>
  </thead>
  <tbody>
  {% for u in items %}
    <tr>
      <td class="font-mono text-sm">#{{ u.id }}</td>
      <td>{{ u.username }}</td>
      <td>
        {% if u.until %}<span class="badge badge-outline">{{ u.until }}</span>
        {% else %}<span class="badge badge-ghost">—</span>{% endif %}
      </td>
      <td class="text-right">
        <button class="btn btn-xs" @click="$refs.editForm.userId.value='{{u.id}}'; $refs.editForm.until.value='{{u.until or ''}}'; $refs.premiumModal.showModal()">Изменить</button>
        <form class="inline" method="post" action="/admin/premium/remove" onsubmit="return confirm('Снять премиум?')">
          <input type="hidden" name="user_id" value="{{ u.id }}" />
          <button class="btn btn-xs btn-error">Снять</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endcall %}

<!-- Footer -->
<div class="mt-4 flex items-center justify-between">
  <div class="text-sm opacity-70">Найдено: {{ items|length }} (страница {{ page }} из {{ page_count }})</div>
  {{ ui.pagination(page, page_count, "/admin/premium") }}
</div>

<!-- Modal -->
<dialog class="modal" x-ref="premiumModal">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-2">Установить/изменить премиум</h3>
    <form method="post" action="/admin/premium/set" class="space-y-3" x-ref="editForm">
      <label class="form-control">
        <div class="label"><span class="label-text">User ID</span></div>
        <input type="number" name="user_id" class="input input-bordered" placeholder="ID пользователя" required />
      </label>
      <label class="form-control">
        <div class="label"><span class="label-text">Until (YYYY‑MM‑DD)</span></div>
        <input type="date" name="until" class="input input-bordered" placeholder="2025-12-31" required />
        <div class="label"><span class="label-text-alt">Укажите дату окончания подписки</span></div>
      </label>
      <div class="modal-action">
        <button type="button" class="btn btn-ghost" @click="$refs.premiumModal.close()">Отмена</button>
        <button class="btn btn-primary">Сохранить</button>
      </div>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

{% endblock %}
